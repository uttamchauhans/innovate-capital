generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = "file:./dev.db"
}

model Client {
  id            Int      @id @default(autoincrement())
  name          String
  email         String?
  mobile        String?
  accountNumber String?
  bankName      String?
  createdAt     DateTime @default(now())

  // Relations
  investments  Investment[]
  interestLogs InterestRecord[]
}

model Investment {
  id       Int    @id @default(autoincrement())
  client   Client @relation(fields: [clientId], references: [id])
  clientId Int

  // Business fields
  amountReceived     Float
  moneyTransferred   Float?
  dateInvested       DateTime
  rateMonthly        Float
  dateInterestStart  DateTime?
  monthlyInterestDay Int
  interestAmount     Float?
  note               String?

  // Metadata
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  payments        Payment[]
  interestRecords InterestRecord[] // ✅ back-relation
}

model Payment {
  id           Int        @id @default(autoincrement())
  investment   Investment @relation(fields: [investmentId], references: [id])
  investmentId Int
  month        DateTime // First day of the month (for uniqueness)
  amount       Float
  paid         Boolean    @default(false)
  paidAt       DateTime?
  createdAt    DateTime   @default(now())

  @@unique([investmentId, month])
}

model InterestRecord {
  id               Int        @id @default(autoincrement())
  client           Client     @relation(fields: [clientId], references: [id])
  clientId         Int

  investment       Investment @relation(fields: [investmentId], references: [id])
  investmentId     Int        // ✅ REQUIRED now

  interestReceived Float
  profitCredited   Float
  profitDay        DateTime
  note             String?
  createdAt        DateTime   @default(now())
}
